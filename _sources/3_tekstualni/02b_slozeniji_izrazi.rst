Сложенији регуларни изрази
==========================

Поклапање једним од неколико израза
-----------------------------------

У прошлој лекцији смо видели да знак ``|`` (који у овом контексту читамо: `или`) у регуларним изразима 
служи да раздвоји алтернативе. На пример, израз ``ученик|ученица`` поклапа речи ``ученик`` и ``ученица``. 
Знак ``|`` се често користи и у комбинацији са облим заградама ``(`` и ``)``, које служе за груписање 
делова израза. На пример, израз ``учени(к|(ца))`` такође поклапа текстове ``ученик`` и ``ученица``, 
тако што поклапа слова ``учени``, за којима следи или слово ``к`` или слова ``ца``.

У следећој табели дато је неколико сличних примера.

.. csv-table:: један од подизраза
    :header: Израз, Примери поклапања
    :widths: 30, 70
    :align: left

    "учени(к|(ца))",                "``ученик``, ``ученица``"
    "бинарно\\s+(дрво)|(стабло)",   "``бинарно дрво``, ``бинарно     стабло``"
    "Крушев((ац)|(ца)|(цу))",       "``Крушевац``, ``Крушевца``, ``Крушевцу``"
    "Крушев(ац)|(ца)|(цу)",         "``Крушевац``, ``ца``, ``цу`` (када се грешком изостави пар заграда)"
    "A((21)|(32))\-B((63)|(15))",   "``A21-B63``, ``A21-B15``, ``A32-B63`` ``A32-B15``"


На тај начин многи регуларни изрази могу да се запишу краће. 

    
**Вежбање**

.. questionnote::

    Задајте регуларан израз који поклапа било коју од речи ``двојица``, ``двојице``, 
    ``двојици``, ``двојицу``, ``двојицом``.
    
    У овом вежбању претрага није осетљива на мала и велика слова.

.. regex-check:: dvojica_padezi
    :flags: gim
    :solution: двојиц(а|е|и|у|(ом))
    :editable:
    
    Поклапања: 
    њих двојица, од њих двојице, њима двојици, њих двојицу, са њима двојицом.
    Непоклапања: 
    двојиц, двојицо, двојиц_.


.. questionnote::

    Задајте регуларан израз који поклапа било који од текстова 

    | ``бели краљ``, ``бели топ``, ``бели ловац``, ``бели скакач``, ``бели пешак``, 
    | ``црни краљ``, ``црни топ``, ``црни ловац``, ``црни скакач``, ``црни пешак``.
    
    У овом вежбању претрага није осетљива на мала и велика слова.

.. regex-check:: sah_figure_osim_dame
    :flags: gim
    :solution: ((бели)|(црни)) ((краљ)|(топ)|(ловац)|(скакач)|(пешак))
    :editable:
    
    Бели краљ је сада на F6, а пешак на F7. Овај бели пешак има кључну улогу, 
    тако да је бели добро проценио ситуацију и паметно разменио остале фигуре 
    (бела дама, бели топ, бели ловац, бели скакач). Црни краљ не може да спречи 
    промоцију и недостаје му бар још црни ловац, који је управо размењен. 
    Црни скакачи су далеко, а црни пешаци на дамином крилу су заостали, тако 
    да су фигуре црног скоро бескорисне у овој позицији.
    У тексту треба да се поклопе: 
    бели краљ, бели топ, бели ловац, бели скакач, бели пешак, 
    црни краљ, црни топ, црни ловац, црни скакач, црни пешак.
    Не треба поклапати појединачна појављивања речи 
    бели, црни, краљ, топ, ловац, скакач, пешак.


.. questionnote::

    Задајте регуларан израз који поклапа назив било које шаховске фигуре (укључујући и даму), 
    тј. било који од текстова 

    | ``бела дама``, ``бели краљ``, ``бели топ``, ``бели ловац``, ``бели скакач``, ``бели пешак``, 
    | ``црна дама``, ``црни краљ``, ``црни топ``, ``црни ловац``, ``црни скакач``, ``црни пешак``.
    
    У овом вежбању претрага није осетљива на мала и велика слова.

.. regex-check:: sah_sve_figure
    :flags: gim
    :solution: (((бели)|(црни)) ((краљ)|(топ)|(ловац)|(скакач)|(пешак)))|(((бела)|(црна)) дама)
    :editable:

    Бели краљ је сада на F6, а пешак на F7. Овај бели пешак има кључну улогу, 
    тако да је бели добро проценио ситуацију и паметно разменио остале фигуре 
    (бела дама, бели топ, бели ловац, бели скакач). Црни краљ не може да спречи 
    промоцију и недостаје му бар још црни ловац, који је управо размењен. 
    Црни скакачи су далеко, а црни пешаци на дамином крилу су заостали, тако 
    да су фигуре црног скоро бескорисне у овој позицији.
    У тексту треба да се поклопе: 
    бела дама, бели краљ, бели топ, бели ловац, бели скакач, бели пешак, 
    црна дама, црни краљ, црни топ, црни ловац, црни скакач, црни пешак.
    Не треба поклапати појединачна појављивања речи 
    бели, црни, бела, црна, дама, краљ, топ, ловац, скакач, пешак.


Границе речи
------------

У досадашњим примерима могли смо да приметимо да наведени регуларни изрази поклапају одговарајуће 
делове текста, без обзира на то да ли је поклопљени део цела реч или део речи. На пример, израз 
``\d{4}`` поклапа сваки низ од 4 цифре, па и делове бројева који имају више од 4 цифре. Проверимо 
ово:

.. regex-check:: visecifreni_brojevi
    :flags: gm
    :solution: \d{4}
    :initregex: \d{4}
    :editable:

    1, 12, 123, 1234, 12345, 123456, 1234567, 12345678, 123456789.

Слично томе, израз ``top`` поклапа делове речи ``potop``, ``toplota`` и слично:

.. regex-check:: top_deo_reci
    :flags: gm
    :solution: top
    :initregex: top
    :editable:

    Poklapanja: top, potop, toplota, topot, otopiti
    Nepoklapanja: to, t-o-p, potpora

Поставља се питање шта треба урадити када желимо да регуларан израз поклапа само целе речи. Додавање 
подизраза за белине ``\s`` пре и/или после главног израза није добро решење, јер непосредно пре или 
после речи могу да се појаве и други карактери осим белина (нпр. знакови интерпункције). Подизраз за карактер 
који није слово, тј. ``[^a-z]``, такође није идеално решење, јер тражена реч може да се појави на 
самом почетку или на самом крају текста. Због тога се у регуларним изразима користи посебан запис 
``\b``, који означава **границу речи**. Испробајте у претходним примерима израз ``\b\d{4}\b`` уместо 
``\d{4}``, односно изразе ``\btop``, ``top\b`` и ``\btop\b`` уместо ``top``.

Почетак и крај реда
-------------------

У регуларним изразима се користе и посебни записи који поклапају почетак, односно крај реда. 
Конкретно, знак ``^`` поклапа почетак, а знак ``$`` крај реда. Користећи ове записе можемо да задамо 
израз који поклапа текст само ако тај текст представља цео ред, или само ако се тај текст налази на 
почетку, односно крају реда. Проверите ово, тако што ћете у следећој претрази да испробате изразе 
``^top``, ``top$`` и ``^top$``. 

.. regex-check:: top_deo_reci
    :flags: gm
    :solution: ^top$
    :editable:

    top
    top potop top toplota 
    topot top otopiti top
    to
    t-o-p
    potpora


Неки практични примери
----------------------

Регуларан израз за време
''''''''''''''''''''''''

Пре него што дођемо до неких регуларних израза који поклапају сва исправно записана времена од 
``00:00`` до ``23:59`` и само таква времена, размотиримо и неке записе који нису сасвим прецизни 
и решавају задатак само приближно. 

**1)** Регуларан израз ``\d\d:\d\d`` није потпуно одговарајући опис за време, јер прихвата и неке 
текстове који не представљају исправно записано време.

.. fillintheblank:: koji_tekst_prolazi_a_ne_treba

    Наведите неки текст који је поклапање за израз ``\d\d:\d\d``, а не представља исправно 
    записано време?

    Одговор: |blank|
    
    - :^\s*((2[4-9]|[3-9][0-9]):\d\d)|(\d\d:[6-9]\d)\s*$: Одговор је тачан.
      :^\d\d:\d\d$: Одговор није тачан, овај запис представља исправно записано време.
      :x: Одговор није тачан, овај запис се не уклапа у дати израз.

**2)** Регуларан израз ``[0-2][0-3]:[0-5][0-9]`` такође није коректан опис времена. Овај пут имамо 
обрнут проблем, а то је да сваки текст који се проналази овим изразом јесте запис времена, 
али неки записи времена не би били пронађени.

.. fillintheblank:: koji_tekst_ne_prolazi_a_treba

    Наведите неки текст који није поклапање за израз ``[0-2][0-3]:[0-5][0-9]``, а представља исправно 
    записано време?

    Одговор: |blank|

    - :^\s*([0-1][4-9]):[0-5]\d\s*$: Одговор је тачан.
      :^[0-2][0-3]:[0-5][0-9]$: Одговор није тачан, овај запис се уклапа у дати израз.
      :x: Одговор није тачан, овај запис не представља исправно записано време.

Ако желимо да формирамо регуларан израз који поклапа сва исправна времена и при томе само њих, потребно 
је да саставимо прецизан опис дозвољених записа. Између осталог, требало би прецизирати да ли се записи 
попут ``4:55`` сматрају исправним, или инсистирамо да се сати увек изражавају двоцифреним бројем, што 
укључује водећу нулу ако је потребна.

Размотримо прво случај са бројем сати који је увек двоцифрен:

- ако је прва цифра у броју сати ``0`` или ``1``, друга цифра може да буде било која
- ако је прва цифра у броју сати ``2``, друга мора да буде из опсега ``0-3``

Закључујемо да број сати може да се опише било којим од регуларних израза ``(0[0-9]|1[0-9]|2[0-3])``, 
``([0-1][0-9]|2[0-3])``, или ``([0-1]\d|2[0-3])``.

Даље, у броју минута прва цифра мора да буде из опсега ``0-5``, а друга може да буде било која. 
Тиме долазимо до израза за комплетан запис времена са бројем сати који је увек двоцифрен, нпр. 
``([0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]`` или ``([0-1]\d|2[0-3]):[0-5]\d``.

Уколико изразом желимо да допустимо и записе времена у којим је број сати једноцифрен, можемо да 
користимо један од израза ``(\d|0\d|1\d|2[0-3]):[0-5]\d``, ``([0-1]?[0-9]|2[0-3]):[0-5][0-9]`` и 
сличних.

Вежбање
-------

Речи које почињу словом `s`
'''''''''''''''''''''''''''

.. questionnote::

    Задајте регуларан израз који поклапа све речи које почињу словом ``s``. 
    У овом вежбању, реч је секвенца слова, пре и после које могу да се нађу 
    почетак реда, крај реда, знаци интерпункције или белине.
    
    У овом вежбању претрага није осетљива на мала и велика слова.

.. comment

    :solution: \bs[a-z]*\b

.. regex-check:: izdvajanje_reci_koje_pocinju_na_s
    :flags: gim
    :solution: \bs[a-z]*\b
    :editable:
    
    Samo sto nisam stigao, siguran sam da necu kasniti.
    Mada, posle svega sto se desilo, mislim da je svejedno.
    Signal S33 je neispravan.
    
.. comment
    
    Seo sam u svoja stara kola,
    ona su moj drugi stan,
    jutro je i svetla se gase
    krenuo sam na Mon Blan.
    Dobra su ta moja stara kola,
    12 konja nisu mala stvar,
    ponekad, al` ne baš često
    pali se i levi far.

    Kad zatvorim desna vrata otvore se leva,
    uključujem brisače, radio mi peva,
    penzioneri padaju od čuda,
    kažu da su moja kola luda.

    Ja vozim dalje...

Датуми
''''''

.. questionnote::

    Задајте регуларан израз који поклапа све датуме у било ком од облика ``dd.mm.gg.``, ``dd.mm.gggg.``, 
    ``dd.mm.``, ``dd.m.``, ``d.mm.``, ``d.m.``. Допуштени су и непостојећи датуми, попут ``31.04.`` 
    и слично, тј. дозвољено је да у наведеним схемама уместо слова ``d``, ``m`` и ``g`` стоје било 
    које цифре. Подразумева се да је запис датума једини текст у том реду.

.. regex-check:: datumi
    :flags: gm
    :solution: ^\d\d?\.\d\d?\.(\d\d(\d\d)?\.)?$
    :editable:
    
    Исправни датуми: 
    01.01. 
    31.01.1999. 
    30.4.18. 
    3.5.27.
    3.04.23.
    Непостојећи датуми у исправном формату: 
    01.13. 
    31.04.1999. 
    34.11.18.
    Неисправни датуми: 
    123.12.1999.
    23.123.1999.
    23.12.199.
    23.12.1.
    
IP адресе
'''''''''

.. questionnote::

    Задајте регуларан израз који поклапа `IP` адресе по стандарду `IPV4`. По овом стандарду, `IP` 
    адреса се састоји од 4 цела броја из опсега 0-255, раздвојена тачкама. Водеће нуле могу а не 
    морају да се користе. Ако се користе водеће нуле, број има тачно три цифре. 
    Подразумева се да је запис `IP` адресе једини текст у том реду.

.. regex-check:: ipv4_adrese
    :flags: gm
    :solution: ^((25[0-5]|2[0-4]\d|[01]\d\d|[1-9]\d|\d)\.){3}(25[0-5]|2[0-4]\d|[01]\d\d|[1-9]\d|\d)$
    
    Поклапања: исправне IPV4 адресе су 
    192.168.1.1  
    127.14.25.192
    127.238.25.192
    1.1.1.1
    127.099.255.255
    127.009.255.255
    127.0.0.1
    255.255.255.255
    Непоклапања: неисправне IPV4 адресе су 
    127.512.34.11
    127.256.25.192
    127.268.25.192
    127.05.25.192
    127.51.34.
    127.12.21

MAC адресе
''''''''''

.. questionnote::

    Задајте регуларан израз који поклапа све MAC адресе. MAC адреса се састоји од 6 група по две 
    хексадекадне цифре, при чему су групе раздвојене цртицама или двотачкама.
    Подразумева се да је запис MAC адресе једини текст у том реду.

.. regex-check:: MAC_adrese
    :flags: gm
    :solution: ^((([0-9A-Fa-f]{2}\:){5}([0-9A-Fa-f]{2}))|(([0-9A-Fa-f]{2}\-){5}([0-9A-Fa-f]{2})))$

    Исправне:
    2B-7A-D4-53-C9-6E
    2B:7A:D4:53:C9:6E
    Неисправне:
    2B:7A-D4:53-C9:6E
    2B:C8:7A:D4:53:C9:6E
    2B:C8:7A:D4:53
    2B:C8:7A:D4:53:C9:
    2B:C8:7A:D4:53:G3
    2B:C8:7A:D4:53:127
    2B-C8-7A-D4-53-C9-6E
    2B-C8-7A-D4-53
    2B-C8-7A-D4-53-C9-
    2B-C8-7A-D4-53-G3
    2B-C8-7A-D4-53-127

Неисправна времена
''''''''''''''''''

У примеру у коме смо формирали регуларан израз за време, поставили смо вам два питања. Једно од 
њих је било ово питање:

.. fillintheblank:: koji_tekst_prolazi_a_ne_treba_2

    Наведите неки текст који је поклапање за израз ``\d\d:\d\d``, а не представља исправно 
    записано време?

    Одговор: |blank|
    
    - :^\s*((2[4-9]|[3-9][0-9]):\d\d)|(\d\d:[6-9]\d)\s*$: Одговор је тачан.
      :^\d\d:\d\d$: Одговор није тачан, овај запис представља исправно записано време.
      :x: Одговор није тачан, овај запис се не уклапа у дати израз.

Одговор који уносите проверава се помоћу регуларних израза. Захваљујући томе, употребљена компонента 
је у стању да прихвати сваки тачан одговор, а не само неке. Осим тога, ова компонента на различите 
нетачне одговоре даје различите коментаре. Можете, на пример, да проверите да за исправна времена 
(који су једна врста нетачног одговора) добијате један коментар, а за текст који није поклапање израза 
``\d\d:\d\d`` (друга врста нетачног одговора) други коментар.

.. questionnote::

    Ваш задатак овде је да задате регуларан израз, који може да се искористи за препознавање 
    тачних одговора на претходно питање. То значи да израз треба да прихвата само неисправна 
    времена, која су поклапање за израз ``\d\d:\d\d``.
    
.. regex-check:: neispravno_vreme_dd_dd
    :flags: gm
    :solution: ((2[4-9]|[3-9][0-9]):\d\d)|(\d\d:[6-9]\d)
    :editable:
    
    Позитивни примери: 
    99:99 
    23:60 
    24:00 
    30:15 

    Негативни примери (исправна времена): 
    19:45 
    00:00 
    23:59 
    07:15 
    
    Остали негативни примери (који нису облика dd:dd): 
    8:45 
    15:0 
    17:ОО 
    dd:dd


Подсетник
---------

- Знак ``|`` служи да раздвоји алтернативе, a може да се комбинује са заградама ради формирања сложенијих израза.
- Знак ``\b`` представља границу речи.
- Знак ``^`` представља почетак реда.
- Знак ``$`` представља крај реда.

.. csv-table:: Сложени изрази
    :header: Израз, Примери поклапања, Примери непоклапања
    :widths: 20, 40, 40
    :align: left

    "Крушев((ац)|(ца)|(цу))",   "``Крушевац``, ``Крушевца``, ``Крушевцу``", "``Крушевц``, ``Крушеваца``, ``ца``"
    "\\btop\\b",                "``top``",                                  "``potop``, ``toplo``"
    "\\btop[a-z]*",             "``top``, ``topot``, ``toplota``",          "``potop``, ``otopljenje``"
    
Простор за експрериментисање
----------------------------

Овде можете да испробате разне регуларне изразе на разним текстовима.

.. regex-check:: bilo_sta
    :flags: gm
    :solution: .{100000}
    :editable:
    
    


.. comment

    - note to self: da proverim kako radi sa ćirilicom

    Вежба: за дати регекс и листу стрингова, одреди које од њих регекс прихвата.
    Вежба: за две листе стрингова напиши регекс који прихвата стрингове из прве листе а не прихвата из друге.
    Вежба: Напиши регекс који издваја подстрингове према датом опису

    https://www.csfieldguide.org.nz/en/chapters/formal-languages/regular-expressions/
    https://www.youtube.com/watch?v=5RLJ6II10uU&list=PL6A42PgbxHNQ5U_GHkTfR_CooeAXnZDcA&index=1
    https://xkcd.com/208/

    Ситуације у којима нам треба, где све могу да се користе. https://www.rexegg.com/regex-uses.html
    - проналажење (и могућа измена) текста у фајловима помоћу напредног уређивача (едитора) текста. // notepad++, grep, sed, awk
    - валидација текстуалног улаза у програм
    - масовно преименовање фајлова
    - промене у кôду
    - директиве веб серверу (редиректовање на нову URL путању, посебно понашање за одређене браузере, за тражење одређеног фајла)
    - проналажење података у бази података употребом ерегекса у упиту
